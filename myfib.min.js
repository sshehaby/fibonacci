var TIM,anim=null;class MyAnim{constructor(){this.anim=null,this.animCouter=0}reset(){this.anim&&this.anim.stop(),this.anim=null,this.animCouter=0,this.tim=0}set(e,t=1){this.anim&&this.anim.stop(),tree&&(this.anim,TIM=parseInt(1e3*t),this.anim1=new Konva.Animation(function(e,t){if(this.animCount+=e.timeDiff,!(this.animCount<TIM)){var r,a;for(this.animCount=0,r=1;r<tree.arrayNodes.length;r++){var i=tree.arrayNodes[r];i.touch&&(i.shape[0].fill(i.colors[i.status]),i.touch=!1)}a="#e6baba"===tree.root.shape[0].fill()?"#fce6e6":"#e6baba",tree.root.shape[0].fill(a)}},layer),this.anim2=new Konva.Animation(function(e){if(this.animCount+=e.timeDiff,!(this.animCount<TIM)){if(this.animCount=0,tree.arrayNodesXX.length){var t=tree.arrayNodesXX[0];if(!t)return Node.drawNode(tree.root),layer.draw(),tree.arrayNodesXX.shift(),void anim.reset();tree.arrayNodesXX.shift();var r=t.node;Node.changeColor(r,t.color),t.text&&Node.changeText(r,t.text),t.fib&&(myarr[t.fib[0]]=redrawArr(myarr[t.fib[0]],fibArr[t.fib[0]],t.fib[1]))}var a;a="#fce6e6"===tree.root.shape[0].fill()?"red":"#fce6e6",tree.root.shape[0].fill(a)}},layer),this.animations=[this.anim1,this.anim2],this.anim=this.animations[e],anim=this,this.anim.start())}}var width,height,stage,layer,group,tr,key,myAnim=new MyAnim,interval=window.setInterval(function(){},1e3);function f1(){divFlag||(console.log("World!"),tree.computeTerminals())}function waitThenDo(e,t){setTimeout(()=>{t()},e)}function computeXYParent(e){var t=[];!function e(r,a,i,n=0){r&&(r.extra=a,r.depth=n,e(r.left,a-i,i/4,n+1),e(r.right,a+i,i/4,n+1),t.push(r))}(e,0,1),t.sort(function(e,t){return e.extra>t.extra?1:t.extra>e.extra?-1:0}),function(){var e,r=-parseInt(t.length/2);for(e=0;e<t.length;e++)t[e].extra=r++}()}document.onkeypress=function(){key=null,window.clearInterval(interval),key=String.fromCharCode(event.which),console.log(String.fromCharCode(event.which))},window.onload=function(){width=window.innerWidth,height=window.innerHeight,stage=new Konva.Stage({container:"container",width:width,height:height}),layer=new Konva.Layer,stage.add(layer),group=new Konva.Group({x:0,y:0,draggable:!0}),layer.add(group),tr=new Konva.Transformer,layer.add(tr),tr.nodes([group]),layer.draw()};var addHV=function(e,t,r,a,i=0){e&&(e.parent?(e.x=t+e.extra*(a+i),e.y=r+3*e.depth*a):(e.x=t+20*e.extra,e.y=r),e.r=a,addHV(e.left,t,r,a,i),addHV(e.right,t,r,a,i))};function doSome(){tree&&createFibTree()}var tree=null,Radius=0,Style=0,Delta=10,myarr=null;function createFibTree(){for(x=document.getElementsByName("radius"),i=0;i<x.length&&!x[i].checked;i++);if(Radius=parseInt(x[i].value),x=document.getElementsByName("DrawingStyle"),Style=x[0].checked?0:1,Delta=parseInt(document.getElementById("delta").value),isNaN(Delta)||Delta<0)return alert("Enter a number >=0"),void(document.getElementById("delta").value=10);divFlag=!1,document.getElementById("dq").disabled=!1,document.getElementById("mm").disabled=!1,document.getElementById("dp").disabled=!1,stage=new Konva.Stage({container:"container",width:5e3,height:3e3}),layer=new Konva.Layer,stage.add(layer),group=new Konva.Group({x:0,y:0,draggable:!0}),layer.add(group),tr=new Konva.Transformer,layer.add(tr),tr.nodes([group]),layer.draw(),myAnim.reset(),input=document.getElementById("base");var e=parseInt(input.value);if(isNaN(e)||e<1)return alert("Enter a number >0"),void(input.value=5);var t=parseFloat(document.getElementById("RefTime1").value);if(isNaN(t)||t<0||t>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime1").value=1);var r=parseFloat(document.getElementById("Time1").value);if(isNaN(r)||r<1||r>30)return alert("Enter a number >=1 and <30"),void(document.getElementById("Time1").value=10);var a=parseFloat(document.getElementById("Time2").value);if(isNaN(a)||a<r||a>40)return alert("Enter a number >="+r+" and <40"),void(document.getElementById("Time2").value=r+2);for((tree=new Tree(e)).createTree(),Style?(computeXYParent(tree.root),addHV(tree.root,width/2,80,Radius,Delta)):computeGeometry(tree.root,width/2,80,Radius,0),Tree.drawLines(tree.root,null),tree.drawAllNodes(),console.log("Len:"+tree.arrayNodes.length);tree.stopWatch;);myAnim.set(0,t),waitThenDo(1e3*r,f1),waitThenDo(1e3*a,function(){divFlag||myAnim.reset()})}function drawCircleText(e,t,r,a,i,n){var o=new Konva.Circle({x:e,y:t,radius:r,fill:a,stroke:"black",strokeWidth:1});group.add(o);var l=new Konva.Text({x:e-(i<10?r/4:r/2),y:t-r/2,text:i,fontSize:r-1,fontFamily:"Arial",fill:n,align:"center",verticalAlign:"middle"});return group.add(l),tr.forceUpdate(),layer.draw(),[o,l]}function drawArr(e,t,r,a,n,o,l,d=!0){if(e)for(i=0;i<e.length;i++)e[i][0].destroy();var s=t.length,u=[];for(d&&(r=parseInt(width/2-s*n/2)),i=0;i<s;i++)u.push([drawRectangleText(r,a,n,o,l,t[i],"black"),r,a,n,o]),r+=n;return u}function hideArray(e){var t;if(e)for(t=0;t<e.length;t++)e[t][0].hide()}function showArray(e){var t;for(t=0;t<e.length;t++)e[t][0].show()}function redrawArr(e,t,r){var a=e[1],i=e[2],n=e[3],o=e[4];return e[0].destroy(),[drawRectangleText(e[1],e[2],e[3],e[4],r,t,"black"),a,i,n,o]}function drawRectangleText(e,t,r,a,i,n,o){var l=new Konva.Group({x:e,y:t,width:r,height:a,rotation:0});return l.add(new Konva.Rect({width:r,height:a,fill:i,stroke:"black"})),l.add(new Konva.Text({text:n,fontSize:24,fontFamily:"Calibri",fill:o,width:r,padding:5,align:"center"})),group.add(l),tr.forceUpdate(),layer.draw(),l}class Node{constructor(e,t){this.left=null,this.right=null,this.parent=t,this.depth=0,this.extra=0,this.shape=null,this.data=e,this.value=-1,this.status=0,this.touch=!1,this.colors=["#fce6e6","#b0d0e8","#cdf7ee"],this.x=0,this.y=0,this.r=0}static drawNode(e){var t=e.data;-1!=e.value&&(t=e.value),e.shape=drawCircleText(e.x,e.y,e.r,e.colors[e.status],t,"black")}static getColor(e){return e.colors[e.status]}static changeColor(e,t){e.shape[0].fill(t)}static changeText(e,t){var r=e.shape[1],a=e.x-(t<10?e.r/4:e.r/2);r.x(a),r.text(t)}}class Tree{constructor(e){var t;for(this.num=e,this.root=null,this.count=0,this.stopWatch=!0,this.array=[],this.array.length=e,this.arrayNodes=[],this.arrayNodesXX=[],this.status=0,t=0;t<e;t++)this.array[t]=-1}computeTerminalsX(e=this.root){e&&(e.data<2?(e.value=1,e.status=2,e.touch=!0):(e.value=-1,e.status=0,e.touch=!0),this.computeTerminalsX(e.left),this.computeTerminalsX(e.right))}computeTerminals(){this.computeTerminalsX(tree.root),tree.status=1}children(e,t){return e?(this.arrayNodes.push(e),t>=1?(e.left=new Node(t-1,e),this.children(e.left,t-1),this.count++):e.left=null,t>=2?(e.right=new Node(t-2,e),this.children(e.right,t-2),this.count++,e):e.right=null):null}createTree(){var e=this.num;this.root=new Node(e,null),this.count=1,this.children(this.root,e),console.log(this.count);var t=getAllNodes(this.root,0);console.log(t)}static getDepth(e){if(!e)return 0;var t=Tree.getDepth(e.left),r=Tree.getDepth(e.right);return t>r?t+1:r+1}drawAllNodes(){Tree.drawNodes(this.root,null),this.stopWatch=!1}static drawNodes(e,t){if(e){Node.drawNode(e);Tree.drawNodes(e.left,e),Tree.drawNodes(e.right,e)}}static drawLines(e,t){if(e){var r=t;if(r){var a=new Konva.Line({x:0,y:0,points:[r.x,r.y,e.x,e.y],stroke:"black",tension:1});group.add(a)}Tree.drawLines(e.left,e),Tree.drawLines(e.right,e)}}}function getAllNodes(e,t){switch(t){case 0:var r="In---Order : ";!function e(t){t&&(e(t.left),r+=t.data.toString()+"  ",e(t.right))}(e);break;case 1:r="Pre--Order : ";!function e(t){t&&(r+=t.data.toString()+"  ",e(t.left),e(t.right))}(e);break;case 2:r="Post-Order : ";!function e(t){t&&(e(t.left),e(t.right),r+=t.data.toString()+" ")}(e);break;case 77:r=[];!function e(t){t&&(e(t.left),e(t.right),t.data>1&&r.push(t))}(e)}return r}function travPreorder(e){var t="Pre--Order : ";return function e(r){r&&(t+=r.data.toString()+"  ",e(r.left),e(r.right))}(e),t}var leftCoordinate=function(e,t,r,a){delta=Math.pow(1.7,10-a)+2*r;Math.pow(2,a-1);return{cx:e-delta,cy:t+3*r}},rightCoordinate=function(e,t,r,a){delta=Math.pow(1.7,10-a)+2*r;Math.pow(2,a-1);return{cx:e+delta,cy:t+3*r}},computeGeometry=function(e,t,r,a,i){if(e){if(e.x=t,e.y=r,e.r=a,e.depth=i,e.left){var n=leftCoordinate(t,r,a,i);computeGeometry(e.left,n.cx,n.cy,a,i+1)}if(e.right){var o=rightCoordinate(t,r,a,i);computeGeometry(e.right,o.cx,o.cy,a,i+1)}}},drawAll=function(e,t){if(e){if(e.draw(),prevNode=t,prevNode)(new Line).draw(prevNode.getX(),prevNode.getY(),e.x,e.y,prevNode.getRadius(),e.ctx);drawAll(e.left,e),drawAll(e.right,e)}};class ColText{constructor(e,t,r,a=null){this.color=t,this.text=r,this.node=e,this.fib=a}}var dc=function(e){if(e){e.status=1;var t=new ColText(e,Node.getColor(e),null);return tree.arrayNodesXX.push(t),e.right?e.value=dc(e.left)+dc(e.right):e.value=dc(e.left),e.status=2,t=new ColText(e,Node.getColor(e),e.value),tree.arrayNodesXX.push(t),e.value}return 1},divFlag=!1,divConq=function(){if(tree){divFlag=!0;var e,t=parseFloat(document.getElementById("RefTime2").value);if(isNaN(t)||t<0||t>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);if(tree.computeTerminals(),myarr)for(e=0;e<myarr.length;e++)myarr[e][0].destroy();for(hideArray(myarr),myarr=null,e=0;e<tree.arrayNodes.length;e++){var r=tree.arrayNodes[e];r.touch&&(r.shape[0].fill(r.colors[r.status]),-1==r.value&&Node.changeText(r,r.data),r.touch=!1)}layer.draw(),tree.status||anim&&myAnim.reset(),tree.arrayNodesXX=[],myAnim.set(1,t);var a=tree.root;dc(a);var i=new ColText(tree.root,"green",tree.root.value);tree.arrayNodesXX.push(i),tree.arrayNodesXX.push(null)}};tree=null;var fibArr,dcm=function(e){if(e){if(fibArr[e.data]>-1){e.value=fibArr[e.data];var t=new ColText(e,"#bae6d6",null);return tree.arrayNodesXX.push(t),e.value}e.status=1;t=new ColText(e,Node.getColor(e),null);return tree.arrayNodesXX.push(t),e.right?e.value=dcm(e.left)+dcm(e.right):e.value=dcm(e.left),e.status=2,t=new ColText(e,Node.getColor(e),e.value,[e.data,"lightblue"]),tree.arrayNodesXX.push(t),fibArr[e.data]=e.value,e.value}return 1},meMoise=function(){if(tree){divFlag=!0;var e=parseFloat(document.getElementById("RefTime2").value);if(isNaN(e)||e<0||e>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);for(tree.computeTerminals(),i=0;i<tree.arrayNodes.length;i++){var t=tree.arrayNodes[i];t.touch&&(t.shape[0].fill(t.colors[t.status]),-1==t.value&&Node.changeText(t,t.data),t.touch=!1)}tree.status||anim&&myAnim.reset(),tree.arrayNodesXX=[],myAnim.set(1,e);var r=tree.root;for(fibArr=[1,1],i=2;i<=tree.num;i++)fibArr.push(-1);(myarr=drawArr(myarr,fibArr,0,10,60,30,"red"))[0]=redrawArr(myarr[0],fibArr[0],"lightblue"),myarr[1]=redrawArr(myarr[1],fibArr[1],"lightblue"),showArray(myarr),layer.draw(),dcm(r),tree.arrayNodesXX.push(null)}},dynP=function(){if(tree){divFlag=!0;var e=parseFloat(document.getElementById("RefTime2").value);if(isNaN(e)||e<0||e>10)return alert("Enter a number >0 and <10"),void(document.getElementById("RefTime2").value=.25);for(tree.computeTerminals(),tree.status||anim&&myAnim.reset(),a=0;a<tree.arrayNodes.length;a++){var t=tree.arrayNodes[a];t.touch&&(t.shape[0].fill(t.colors[t.status]),-1==t.value&&Node.changeText(t,t.data),t.touch=!1)}tree.arrayNodesXX=[],myAnim.set(1,e);var r=tree.root;for(fibArr=[1,1],a=2;a<=tree.num;a++)fibArr.push(-1);(myarr=drawArr(myarr,fibArr,0,10,60,30,"red"))[0]=redrawArr(myarr[0],fibArr[0],"lightblue"),myarr[1]=redrawArr(myarr[1],fibArr[1],"lightblue"),showArray(myarr),layer.draw();var a,i=getAllNodes(tree.root,77);for(a=0;a<i.length;a++){r=i[a];if(fibArr[r.data]>-1){r.value=fibArr[r.data];var n=new ColText(r,"#bae6d6",r.value,[r.data,"lightblue"]);tree.arrayNodesXX.push(n)}else r.value=r.left.value+r.right.value,r.status=2,n=new ColText(r,Node.getColor(r),r.value,[r.data,"lightblue"]),tree.arrayNodesXX.push(n),fibArr[r.data]=r.value}tree.arrayNodesXX.push(null)}};